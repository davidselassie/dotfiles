#!/usr/bin/env python

from __future__ import division

import sys
import math
import optparse

parser = optparse.OptionParser(usage="%prog [options] in_files...")
parser.add_option("-n", type="int", dest="lines", help=
	"maximum number of lines in one output parts; overrides -f")
parser.add_option("-f", type="int", dest="fractions", default=2, help=
	"number of approximately equal sized parts to split the file into")
parser.add_option("-o", dest="output")

(options, argv) = parser.parse_args()

if len(argv) < 1:
	parser.error("You must specify an in_file.")

for in_file in argv:
	if not options.output:
		options.output = in_file

	file_len = len(file(in_file).readlines())
	if not options.lines:
		max_index = math.ceil(file_len / options.fractions)
	else:
		max_index = options.lines

	if max_index >= file_len:
		sys.stderr.write("File will only have one part, part sizes are too big.\n")

	part_index = 0
	out = file("/dev/null")
	for (index, line) in enumerate(file(in_file)):
		if index % max_index == 0:
			out.close()
			out = file(options.output + "." + str(part_index), "w")
			part_index += 1

		out.write(line)

	out.close()

