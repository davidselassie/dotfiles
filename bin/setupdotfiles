#!/bin/zsh

setopt errexit
setopt xtrace

if [[ -d "$HOME/.dotfiles" ]]; then
    (cd "$HOME/.dotfiles";
     git pull --rebase origin master)
else
    (cd "$HOME";
     git clone https://github.com/selassid/dotfiles.git .dotfiles)
fi

if [[ ! -d "$HOME/.oh-my-zsh" ]]; then
    curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh
    (cd "$HOME";
     rm .zshrc)
elif [[ $(dscl . -read "/Users/$USER" UserShell) != */zsh ]]; then
    chsh -s /bin/zsh
fi

if [[ -z $(command -v brew) ]]; then
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

if [[ -z $(command -v stow) ]]; then
    brew install stow
fi

# if [[ $(head -n1 "$HOME/.emacs.d/init.el") != (*Emacs LIVE*) ]]; then
#     bash <(curl -fksSL https://raw.github.com/overtone/emacs-live/master/installer/install-emacs-live.sh)
# fi

# if [[ ! -d "$HOME/.live-packs/selassid-pack" ]]; then
#     mkdir -pv "$HOME/.live-packs"
#     (cd "$HOME/.live-packs";
#      git clone git@github.com:selassid/selassid-pack.git)
# fi

stow -v -d "$HOME/.dotfiles" -t "$HOME" shell git ssh atom
