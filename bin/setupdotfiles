#!/bin/zsh

setopt errexit
setopt xtrace

if [[ -d "$HOME/.dotfiles" ]]; then
    (cd "$HOME/.dotfiles";
     git pull --rebase origin master)
else
    (cd "$HOME";
     git clone https://github.com/selassid/dotfiles.git .dotfiles)
fi

if [[ ! -d "$HOME/.oh-my-zsh" ]]; then
    curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh
    (cd "$HOME";
     rm .zshrc)
elif [[ $(dscl . -read "/Users/$USER" UserShell) != */zsh ]]; then
    chsh -s /bin/zsh
fi

if [[ -z $(command -v brew) ]]; then
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

brew install stow tmux git
brew cask install iterm2 emacs karabiner

stow -v -d "$HOME/.dotfiles" -t "$HOME" shell local git ssh emacs oskeys tmux
