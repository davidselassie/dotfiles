#!/bin/bash

set -eEox

if [[ -z "$(command -v brew)" ]]; then
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

brew install \
  fish \
  stow \
  kryptco/tap/kr \
  ripgrep \
  jq \
  miller \
  fex \
  watch \
  pv \
  dos2unix

if [[ ! -f "$HOME/.config/fish/functions/fisher.fish" ]]; then
    curl -Lo "$HOME/.config/fish/functions/fisher.fish" --create-dirs https://git.io/fisher
    fish -c fisher
fi

if [[ $(dscl . -read "/Users/$USER" UserShell) != */fish ]]; then
    chsh -s /usr/local/bin/fish
fi

export STOW_DIR="$HOME/.dotfiles"
stow -v -t "$HOME" --no-folding --ignore='\.DS_Store' local fish atom
# Things that don't support having symlink files, just directories.
stow -v -t "$HOME" --ignore='\.DS_Store' ssh git karabiner hammerspoon services
