#!/bin/bash

set -eEox

if [[ -z "$(command -v brew)" ]]; then
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

if [[ -z "$(command -v fish)" ]]; then
    brew install fish
fi

if [[ -z "$(command -v fisher)" ]]; then
    curl -Lo "$HOME/.config/fish/functions/fisher.fish" --create-dirs https://git.io/fisher
    fisher
fi

if [[ $(dscl . -read "/Users/$USER" UserShell) != */fish ]]; then
    chsh -s /usr/local/bin/fish
fi

if [[ -z "$(command -v stow)" ]]; then
    brew install stow
fi

export STOW_DIR="$HOME/.dotfiles"
stow -v -t "$HOME" --no-folding --ignore='\.DS_Store' local
# Things that don't support having symlink files, just directories.
stow -v -t "$HOME" --ignore='\.DS_Store' fish vis ssh git karabiner hammerspoon services
